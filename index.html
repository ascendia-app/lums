<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LUMS Admission Calculator</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-r from-pink-100 via-purple-100 to-blue-100 min-h-screen flex items-center justify-center">

<div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-3xl">
  <h1 class="text-3xl font-bold mb-6 text-center">LUMS Admission Calculator</h1>

  <form id="calcForm">

    <!-- Program Selection -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">Select Program</label>
      <select name="program" id="program" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-300">
        <option value="">-- Choose Program --</option>
        <option value="BA-LLB">BA-LLB</option>
        <option value="BS CS">BS Computer Science</option>
        <option value="BSc Economics">BSc Economics</option>
        <option value="BS Accounting & Finance">BS Accounting & Finance</option>
        <option value="BSc Physics">BSc Physics</option>
      </select>
    </div>

    <!-- School Selection -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">Select School</label>
      <select name="school" id="school" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-300">
        <option value="">-- Choose School --</option>
        <option value="School of Law">School of Law</option>
        <option value="School of Science & Engineering">School of Science & Engineering</option>
        <option value="School of Economics">School of Economics</option>
        <option value="School of Social Sciences & Humanities">School of Social Sciences & Humanities</option>
        <option value="School of Management Sciences">School of Management Sciences</option>
      </select>
    </div>

    <!-- Matric Percentage -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">Matric Percentage</label>
      <input type="number" name="matric_percentage" placeholder="e.g. 92" min="0" max="100" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-300">
    </div>

    <!-- FSc / A-Level Percentage -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">FSc / A-Level Percentage</label>
      <input type="number" name="fsc_percentage" placeholder="e.g. 88" min="0" max="100" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-300">
    </div>

    <!-- O-Level / A-Level Subjects -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">O-Level / A-Level Subjects</label>
      <div id="subjectsSection">
        <div class="flex gap-2 mb-2 subject-entry">
          <select name="subject_level" class="w-1/3 border rounded px-2 py-1">
            <option value="O-Level">O-Level</option>
            <option value="A-Level">A-Level</option>
          </select>
          <input type="text" name="subject_name" placeholder="Subject Name" class="w-1/3 border rounded px-2 py-1">
          <select name="subject_grade" class="w-1/3 border rounded px-2 py-1">
            <option value="A*">A*</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
          </select>
          <button type="button" class="remove-subject text-red-500 font-semibold">Remove</button>
        </div>
      </div>
      <button type="button" id="addSubject" class="text-purple-600 font-semibold text-sm mt-2">+ Add Subject</button>
    </div>

    <!-- SAT Score -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">SAT Score</label>
      <input type="number" name="sat" placeholder="e.g. 1480" min="400" max="1600" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-300">
    </div>

    <!-- Extracurriculars -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">Extracurriculars</label>
      <div id="ecaSection">
        <div class="flex gap-2 mb-2 eca-entry">
          <input type="text" name="eca_field" placeholder="Activity / Field" class="w-1/3 border rounded px-2 py-1">
          <input type="text" name="eca_level" placeholder="Level / Position" class="w-1/3 border rounded px-2 py-1">
          <input type="text" name="eca_notes" placeholder="Notes" class="w-1/3 border rounded px-2 py-1">
          <button type="button" class="remove-eca text-red-500 font-semibold">Remove</button>
        </div>
      </div>
      <button type="button" id="addECA" class="text-purple-600 font-semibold text-sm mt-2">+ Add ECA</button>
    </div>

    <!-- Calculate Button -->
    <button type="submit" class="w-full bg-purple-500 text-white py-2 rounded hover:bg-purple-600 transition-colors font-semibold">Calculate</button>
  </form>

  <!-- Result Display -->
  <div id="result" class="mt-6 text-center text-xl font-bold"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const subjectsSection = document.getElementById('subjectsSection');
  const addSubjectBtn = document.getElementById('addSubject');
  addSubjectBtn.addEventListener('click', () => {
    const newEntry = subjectsSection.querySelector('.subject-entry').cloneNode(true);
    newEntry.querySelectorAll('input, select').forEach(el => el.value = '');
    subjectsSection.appendChild(newEntry);
  });

  subjectsSection.addEventListener('click', e => {
    if(e.target.classList.contains('remove-subject')) {
      e.target.closest('.subject-entry').remove();
    }
  });

  const ecaSection = document.getElementById('ecaSection');
  const addEcaBtn = document.getElementById('addECA');
  addEcaBtn.addEventListener('click', () => {
    const newEntry = ecaSection.querySelector('.eca-entry').cloneNode(true);
    newEntry.querySelectorAll('input, select').forEach(el => el.value = '');
    ecaSection.appendChild(newEntry);
  });
  ecaSection.addEventListener('click', e => {
    if(e.target.classList.contains('remove-eca')) {
      e.target.closest('.eca-entry').remove();
    }
  });

  // Submit form
  const form = document.getElementById('calcForm');
  form.addEventListener('submit', async e => {
    e.preventDefault();

    const subjects = Array.from(subjectsSection.querySelectorAll('.subject-entry')).map(entry => ({
      level: entry.querySelector('[name="subject_level"]').value,
      name: entry.querySelector('[name="subject_name"]').value,
      grade: entry.querySelector('[name="subject_grade"]').value
    }));

    const ecas = Array.from(ecaSection.querySelectorAll('.eca-entry')).map(entry => ({
      field: entry.querySelector('[name="eca_field"]').value,
      level: entry.querySelector('[name="eca_level"]').value,
      notes: entry.querySelector('[name="eca_notes"]').value
    }));

    const data = {
      program: form.program.value,
      school: form.school.value,
      matric: Number(form.matric_percentage.value) || 0,
      fsc: Number(form.fsc_percentage.value) || 0,
      sat: Number(form.sat.value) || 0,
      subjects,
      ecas
    };

    try {
      const response = await fetch('http://127.0.0.1:5000/calculate', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(data)
      });
      const result = await response.json();
      document.getElementById('result').innerText = `
Program: ${data.program || 'Not Selected'}
School: ${data.school || 'Not Selected'}
Total Score: ${result.total_score}
AI Analysis: ${result.ai_analysis || 'N/A'}
`;
    } catch (err) {
      console.error(err);
      document.getElementById('result').innerText = 'Error calculating score. Make sure backend is running.';
    }
  });
});
</script>

</body>
</html>
